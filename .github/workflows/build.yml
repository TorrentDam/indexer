name: build

on:
  push: {}
  schedule:
    - cron: '0 * * * *'

jobs:

  build:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout
      uses: actions/checkout@v2
      with:
        path: "master"

    - name: Set up java
      uses: actions/setup-java@v1
      with:
        java-version: 14
        java-package: jre

    - name: Build
      run: ./mill jobs.assembly
      working-directory: ./master

    - name: Checkout torrents
      uses: actions/checkout@v2
      with:
        repository: TorrentDam/torrents
        ref: master
        path: torrents
        token: ${{ secrets.BOT_ACCESS_TOKEN }}

    - name: Discover
      run: java --class-path ../master/out/jobs/assembly/dest/out.jar Discover
      working-directory: ./torrents

    - name: Index
      run: java --class-path ../master/out/jobs/assembly/dest/out.jar Index
      working-directory: ./torrents

    - name: Commit
      uses: stefanzweifel/git-auto-commit-action@v4.4.0
      with:
        repository: ./torrents
        commit_message: Discover
        commit_user_email: 41898282+github-actions[bot]@users.noreply.github.com
        commit_author: github-actions[bot] <41898282+github-actions[bot]@users.noreply.github.com>
